<div class="min-h-screen py-8 px-4 md:px-6 lg:px-8 pb-24 md:pb-8">
  <div class="max-w-7xl mx-auto space-y-8">
    <div
      class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4"
    >
      <div>
        <h1 class="text-3xl md:text-4xl font-bold text-foreground">
üöõ {{ 'COLLECTOR.ACTIVE.TITLE' | translate }}
        </h1>
<p class="text-muted-foreground mt-2">
  {{ 'COLLECTOR.ACTIVE.SUBTITLE' | translate }}
</p>      </div>
    </div>
    @if (flashMessage) {
  <div
    class="alert mb-4"
    [class.alert-success]="flashType === 'success'"
    [class.alert-danger]="flashType === 'error'"
  >
    {{ flashMessage }}
  </div>
}
<app-card-content>
  <div class="space-y-4 max-h-[600px] overflow-y-auto requests-list pr-2">

    @for (request of activeRouteRequests(); track request.id; let i = $index) {

      <div
        class="border border-border rounded-xl p-4 hover:shadow-lg hover:border-primary/40 transition-all cursor-pointer group bg-white"
      >

        <!-- Header -->
        <div class="flex items-center justify-between mb-3">
          <div>
            <h3 class="font-bold text-base text-card-foreground">
              #{{ i + 1 }} Order #{{ request.id }}
              @if (request.orderDate) {
                <span class="font-semibold text-card-foreground">
                  {{ " , " + formatDate(request.orderDate) }}
                </span>
              }
            </h3>
          </div>

          <div class="text-right">
            <app-badge [variant]="getBadgeVariant(request.status)">
              {{ getStatusText(request.status) }}
            </app-badge>
          </div>
        </div>

        <!-- From & To -->
        <div class="grid grid-cols-2 gap-3 mb-3">

          <!-- FROM -->
          <div class="p-3 border-l-4 border-l-blue-500 bg-blue-50/50 rounded-lg">
            <p class="text-xs font-bold text-blue-700 uppercase tracking-wide mb-1">
üìç {{ 'COLLECTOR.FROM_PICKUP' | translate }}
            </p>
            <div class="text-xs space-y-1">
              <p class="font-semibold text-gray-800">{{ request.userName }}</p>

              @if (request.street) {
                <p class="text-gray-700">{{ 'COMMON.STREET' | translate }} {{ request.street }}</p>
              }
              @if (request.buildingNo) {
                <p class="text-gray-700">{{ 'COMMON.BUILDING' | translate }} {{ request.buildingNo }}</p>
              }
              @if (request.apartment) {
                <p class="text-gray-700">{{ 'COMMON.APARTMENT' | translate }} {{ request.apartment }}</p>
              }
              @if (request.city) {
                <p class="text-gray-700">{{ 'COMMON.CITY' | translate }} {{ request.city }}</p>
              }
            </div>
          </div>

          <!-- TO -->
          <div class="p-3 border-l-4 border-l-green-500 bg-green-50/50 rounded-lg">
            <p class="text-xs font-bold text-green-700 uppercase tracking-wide mb-1">
üè≠ {{ 'COLLECTOR.TO_DELIVERY' | translate }}
            </p>
            <div class="text-xs space-y-1">
              @if (request.factoryName) {
                <p class="font-semibold text-gray-800">{{ request.factoryName }}</p>
              }
              @if (request.factoryArea) {
                <p class="text-gray-700">{{ 'COMMON.AREA' | translate }} {{ request.factoryArea }}</p>
              }
              @if (request.factoryStreet) {
                <p class="text-gray-700">{{ 'COMMON.STREET' | translate }} {{ request.factoryStreet }}</p>
              }
              @if (request.factoryBuildingNo) {
                <p class="text-gray-700">
                  {{ 'COMMON.BUILDING' | translate }} {{ request.factoryBuildingNo }}
                </p>
              }
              @if (request.factoryCity) {
                <p class="text-gray-700">{{ 'COMMON.CITY' | translate }} {{ request.factoryCity }}</p>
              }
            </div>
          </div>

        </div>

        <!-- Details -->
        <div class="flex items-center gap-4 text-sm text-muted-foreground mb-3 py-2 border-y border-border/30">

          @if (request.quantity) {
            <div class="flex items-center gap-2">
              <span class="text-base">‚öñÔ∏è</span>
              <div>
                <p class="text-muted-foreground">{{ 'COMMON.QUANTITY' | translate }}</p>
                <p class="font-semibold text-card-foreground">
                  {{ request.quantity }} kg
                </p>
              </div>
            </div>
          }

          @if (request.email) {
            <div class="flex items-center gap-2">
              <span class="text-base">üìß</span>
              <span class="truncate">{{ request.email }}</span>
            </div>
          }

        </div>

        <!-- Action Buttons -->
<!-- Action Buttons -->
@if (request.status.toLowerCase() === 'accepted') {

  <div class="grid grid-cols-2 gap-3">

    <!-- Mark Collected -->
    <button
      class="py-2.5 px-3 bg-gradient-to-r from-blue-600 to-blue-700
             hover:from-blue-700 hover:to-blue-800
             text-white text-sm font-bold rounded-lg transition-all shadow-sm"
      (click)="changeStatus(request.id, 'Collected'); $event.stopPropagation()"
    >
{{ 'COLLECTOR.ACTIONS.MARK_COLLECTED' | translate }}
    </button>

    <!-- Reject -->
    <button
      class="py-2.5 px-3 bg-gradient-to-r from-red-600 to-red-700
             hover:from-red-700 hover:to-red-800
             text-white text-sm font-bold rounded-lg transition-all shadow-sm"
      (click)="rejectOrder(request.id); $event.stopPropagation()"
    >
{{ 'COLLECTOR.ACTIONS.REJECT' | translate }}
    </button>

  </div>
}

@if (request.status.toLowerCase() === 'collected') {
  <button
    class="w-full py-2.5 px-3 bg-gradient-to-r from-green-600 to-green-700
           hover:from-green-700 hover:to-green-800
           text-white text-sm font-bold rounded-lg transition-all shadow-sm"
    (click)="changeStatus(request.id, 'Delivered'); $event.stopPropagation()"
  >
{{ 'COLLECTOR.ACTIONS.MARK_DELIVERED' | translate }}
  </button>
}

      </div>
    }

    <!-- Empty State -->
    @if (activeRouteRequests().length === 0) {
      <div class="text-center py-16 text-muted-foreground">
        <span class="text-6xl block mb-4">üì¶</span>
<p class="font-semibold text-lg">
  {{ 'COLLECTOR.EMPTY.NO_ACTIVE' | translate }}
</p>

<p class="text-sm mt-2">
  {{ 'COLLECTOR.EMPTY.NO_ACTIVE_DESC' | translate }}
</p>

      </div>
    }

  </div>
</app-card-content>
  </div>
</div>
